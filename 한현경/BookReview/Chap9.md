📕 <b> [9장] 암과 싸워 이기기 위한 파이토치 활용</b> (●'◡'●)

### 9.2 대규모 프로젝트 준비
- <b>환자의 흉부 CT 스캔을 입력으로 받아서 악성 종양을 탐지하는 딥러닝 프로젝트</b>
- 준비사항
    - 프로젝트를 진행하려면 모델 아키텍처 설계에 앞서 사용할 데이터에 대해 알아야 한다.
    - 프로젝트를 직접 실행하기 위해서는 `최소 8GB 이상의 RAM을 갖춘 GPU`가 필요하다. (GPU가 없는 경우 Chap.14의 사전 훈련된 모델 사용)
    그리고 원본 훈련 데이터, 캐시 데이터, 훈련된 모델을 저장하기 위해 `220GB의 디스크 공간`이 필요하다.
- 문제를 해결하는 태도
    - `Divide and Conquer` : 문제를 작은 조각으로 나눠서 생각한다.
    - `배경지식` 쌓기 : 의학 분야에 대한 통찰력을 가져야 한다.

### 9.3 CT 스캔이란
- 책의 프로젝트에서는 주로 CT스캔 데이터를 다룬다.
- `CT스캔`은 단일 채널의 3차원 배열로 표현되는 3차원 엑스레이이다. (마치 흑백 PNG 이미지를 차곡차곡 쌓아둔 형태)
- `복셀(voxel)`이란?
    - `VOlumetric piXEL(용적 픽셀)`
    - 면적이 아닌 공간 용적을 담고 있으며, 데이터 필드를 표현하기 위해 3차원 격자로 배열된다. 각 차원 내에서는 거리를 측정할 수 있다. 통상적으로 복셀은 정육면체지만 이 장에서 다루는 복셀은 직육면체이다.
    - 의학 분야 외에도 2차원 이미지로 재구성된 3차원 장면, 자율주행 자동차의 라이다(LIDAR, Light Detection and Ranging) 데이터에서도 복셀이 쓰인다.
- CT스캔 내 복셀을 해당 위치에 있는 물체의 평균 질량 밀도를 나타내는 숫자 값을 가진다.
    - 데이터들을 시각화하면 밀도가 높은 조직(뼈나 금속 임플란트)은 하얀색, 밀도가 낮은 조직(공기, 폐조직)은 검은색으로 보이고, 지방이나 조직은 다양한 밝기의 회색으로 나타난다. 
- CT vs. X-ray
    - X-ray의 경우 3차원 강도를 2차원 평면에 투영한 반면 CT스캔은 데이터의 3차원 형태를 보존한다.
    - CT는 X-ray와 달리 데이터가 digital format이다. 즉, 스캔의 원본 출력은 육안으로 알아볼 수 있는 형태가 아니라서 컴퓨터를 사용해 재해석해야 한다. 스캔 시 CT 스캐너의 설정에 따라 출력 데이터가 달라진다.

### 9.4 프로젝트: 엔드투엔드 폐암 진단기
- `결절`이란?
    - 증식하는 세포로 이뤄진 조직 덩어리를 종양(tumor)이라고 한다. 종양은 양성(benign) 혹은 악성(malignant)로 나뉘며, 악성일 경우 암이라고도 한다. 폐에 있는 작은 종양을 폐 결절(lung nodule)이라고 한다. 폐 결절의 40%는 악성인 것으로 알려진다. 따라서 최대한 초기에 잡아내는 것이 중요한데, 이 프로젝트에서처럼 이를 의학 영상 이미지로 발견할 수 있다. 
    - 암은 항상 결절의 형태를 띤다.(따라서 classifier는 모든 조직을 알아볼 필요 없이 결절에만 집중하면 된다.)

- 흉부 CT스캔 조사에서 환자에게 폐암 진단을 내리는 과정은 `총 5개의 단계`로 나눌 수 있다. 
    1. `Data Loading` : 원본 CT스캔 데이터를 파이토치에서 사용할 수 있는 형태로 읽어들인다. 
    2. `Segmentation` : 파이토치를 사용하여 폐의 잠재적 결절에 해당하는 복셀을 찾는다. 일종의 히트맵을 작성하는 과정이다. 관심없는 해부학적 부위(위, 간 등 폐암과는 무관한 부위)를 무시하고 폐 내부에 집중할 수 있다. 
    3. `Data 그룹화` : 관심 있는 복셀들(폐암 후보 결절)을 덩어리로 묶는다. 그리고 각 핫스팟의 개략적인 중심부를 찾는 과정을 진행한다. 결절마다 인덱스가 부여되며 이 정보는 최종 분류기에 전달된다. 이 과정을 파이토치를 요구하지 않아서 별도의 단계로 구성되었다.
    4. `Classification(분류하기)` : 3차원 convolution을 사용해 각 후보결절을 실제 결절인지 아닌지 결정한다. 이때 입력 데이터를 걸러내는 것과, 너무 걸러내다가 중요한 정보까지 버려지는 것 사이에서 균형을 잡을 필요가 있다. -> `overfitting 과 underfitting의 개념일까?`
    5. `Diagnose(진단 내리기)` : 각 결절별로 분류한 결과를 종합하여 환자를 진단한다. 결절별로 악성 예측을 구한 후 이들의 최댓값을 사용하는 방식으로 하나라도 악성이 예측된 경우, 암 소견을 보인다고 결정한다. 
- `3단계`와 `4단계`에서 훈련에 사용하는 데이터는 사람이 확인하고 표기한 정답을 제공한다. -> `2단계와 3단계, 4단계를 순서에 상관없이 개별로 진행할 수 있다`가 무슨 의미일까..?

### 9.4.3 데이터 소스 : LUNA 그랜드 챌린지
- LUNA(LUng Nodule Analysis) 2016 그랜드 챌린지에서 가져온 CT스캔 데이터를 사용한다.
    - 환자의 CT스캔 자료를 고품질로 레이블 작업한 공개 데이터셋임.
- LUNA 데이터 다운로드
    - 압축을 풀면 120GB 공간을 차지하는 데이터셋.
    - CT데이터 전체를 읽는 대신 필요한 부분만 읽도록 데이터를 작은 덩어리로 나눠둘 100GB 정도의 캐시 공간이 필요하다.
    - 데이터는 10개의 subset들(subset0~subset9)로 이루어지고, 데이터셋 파일 압축을 풀면 `code/data-unversioned/part2/luna/subset()`과 같은 개별 서브 디렉토리가 보인다.
    - Window 사용자는 7-Zip(www.7-zip.org) 웹사이트에서 압축 해제 프로그램을 다운받을 수 있다.
    - `candidates.csv`와 `annotations.csv`파일도 필요하다. 책의 깃허브와 웹사이트에 코드 있음. -> code/data/part2/luna/*.csv
    - candidates 파일과 한 개 이상의 서브셋 파일을 내려받아 압축을 푼 후 정확한 경로에 넣었으면 다음 장의 예제가 실행가능할 것이다. 



